# OneTabPro 当前工作背景

## 当前重点

我们目前处于 OneTabPro 的初始项目设置阶段，重点关注：

1. **项目架构和规划**

   - 定义系统组件及其交互
   - 选择技术栈和工具
   - 建立开发工作流程

2. **开发环境设置**

   - 创建仓库结构
   - 配置开发工具
   - 准备本地环境

3. **核心功能规划**
   - 扩展清单配置
   - 后端 API 端点规划
   - 数据库架构设计

## 近期决策

1. **技术栈**

   - 前端：用于扩展 UI 的 React + TypeScript 和 Tailwind CSS
   - 后端：用于 serverless API 的 Node.js 和 Hono.js
   - 数据库：带 Prisma ORM 的 Neon PostgreSQL
   - 部署：用于 serverless 函数的 Vercel

2. **认证策略**

   - 基于二维码扫描的微信认证
   - 用于 API 授权的 JWT 令牌
   - 使用 chrome.storage.local 在扩展中安全存储令牌

3. **数据同步方法**
   - 客户端发起的同步
   - 基于时间戳的冲突解决
   - 批量操作以提高效率

## 当前挑战

1. **微信 OAuth 集成**

   - 需要研究微信开发者要求
   - 确定浏览器扩展的回调 URL 处理
   - 规划二维码显示和扫描流程

2. **扩展架构**

   - 适应 Manifest V3 限制
   - 后台 service worker 生命周期管理
   - API 调用的跨域考虑

3. **数据库设计优化**
   - 标签组和标签页的高效架构
   - 性能的索引策略
   - serverless 环境的连接池

## 下一步

### 紧急任务

1. 创建初始项目仓库结构
2. 使用基本工具设置开发环境
3. 创建 Chrome 扩展清单和基本结构
4. 设计和实现初始数据库架构
5. 实现核心后端 API 结构

### 短期目标

1. 实现基本的标签页收集和存储功能
2. 创建初始 UI 组件
3. 设置微信 OAuth 集成
4. 实现 JWT 令牌认证
5. 创建数据同步框架

### 中期目标

1. 开发完整的标签页管理 UI
2. 实现双向同步
3. 添加组管理功能（重命名、锁定等）
4. 创建用于访问已保存标签页的 Web 客户端
5. 实现全面的错误处理

## 实施说明

### 扩展实施

- 后台 service worker 将处理标签页操作和 API 调用
- 弹出式 UI 将提供查看和管理标签组的主要界面
- 本地存储将缓存数据以实现离线访问和性能

### 后端实施

- 基于资源的 RESTful API 端点
- 用于认证和验证的中间件
- 用于类型安全数据库访问的 Prisma
- 具有一致响应格式的错误处理

### 数据库实施

- 带有微信认证详情的用户表
- 链接到用户的标签组表
- 链接到组的标签页表
- 频繁查询字段的索引

## 开放问题

1. 当同一标签组在多个设备上被修改时，我们应如何处理冲突解决？
2. 在扩展中处理离线功能的最佳方法是什么？
3. 我们应如何管理标签组共享权限？
4. 标签数据的最佳缓存策略是什么，以最小化 API 调用？
5. 我们应如何实现速率限制以防止 API 滥用？

## 资源需求

1. **开发资源**

   - 用于 OAuth 集成的微信开发者账户
   - Neon PostgreSQL 账户用于数据库
   - Vercel 账户用于 serverless 托管
   - Chrome 开发者账户用于扩展部署

2. **外部服务**

   - 网站图标获取服务或策略
   - 监控和日志记录解决方案

3. **文档需求**
   - API 文档
   - 数据库架构文档
   - 扩展架构文档
